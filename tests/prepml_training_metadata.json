{"training_id": "live-mule", "mlflow_run_id": "3022f4fed6ad462e9bf6678a31f64ced", "owner": "ecm6116", "time": "2025-03-25T10:43:46.262398", "prepml_command": "/perm/ecm6116/conda/envs/prepml/bin/python3 -m prepml", "prepml_module_version": "0.87.1.dev9+gf91f93ec", "config_home": "/home/ecm6116/prepml/training/live-mule", "input": "/home/ecm6116/Documents/workingdir/tools/python/prepml/configs/training.yaml", "run_number": 42, "config": {"description": "Anemoi training xxx", "platform": {"name": "atos"}, "resources": {"total_nodes": 1, "memory_per_node": "64G", "training": {"total_nodes": 1, "gpu": {"gpus_per_node": 1}, "cpu": {"cpus_per_task": 32, "tasks_per_node": 1, "memory_per_node": "64G"}, "custom_directives": []}}, "runner": {"name": "anemoi-training", "conda": "/perm/ecm6116/conda/envs/anemoi-training"}, "training": {"name": "anemoi", "config": {"path": "/home/ecm6116/Documents/workingdir/tools/python/anemoi-core/training/configs", "name": "dev_mlflow"}, "run_time": "30m", "step_run_time": "10m"}}, "training_config": {"data": {"diagnostic": ["tp", "cp"], "forcing": ["cos_latitude", "cos_longitude", "sin_latitude", "sin_longitude", "cos_julian_day", "cos_local_time", "sin_julian_day", "sin_local_time", "insolation", "lsm", "sdor", "slor", "z"], "format": "zarr", "frequency": "6h", "imputer": {"default": "none"}, "normalizer": {"default": "mean-std", "max": ["sdor", "slor", "z"], "min-max": null, "none": ["cos_latitude", "cos_longitude", "sin_latitude", "sin_longitude", "cos_julian_day", "cos_local_time", "sin_julian_day", "sin_local_time", "insolation", "lsm"], "std": ["tp"]}, "num_features": null, "processors": {"normalizer": {"_target_": "anemoi.models.preprocessing.normalizer.InputNormalizer", "config": "${data.normalizer}"}}, "remapped": null, "remapper": {"default": "none"}, "timestep": "6h"}, "dataloader": {"batch_size": {"test": 4, "training": 2, "validation": 4}, "dataset": "${hardware.paths.data}/${hardware.files.dataset}", "grid_indices": {"_target_": "anemoi.training.data.grid_indices.FullGrid", "nodes_name": "${graph.data}"}, "limit_batches": {"test": 2, "training": 10, "validation": 2}, "num_workers": {"test": 8, "training": 8, "validation": 8}, "pin_memory": true, "prefetch_factor": 2, "read_group_size": "${hardware.num_gpus_per_model}", "test": {"dataset": "${dataloader.dataset}", "drop": [], "end": null, "frequency": "${data.frequency}", "start": 2022}, "training": {"dataset": "${dataloader.dataset}", "drop": [], "end": 2020, "frequency": "${data.frequency}", "start": null}, "validation": {"dataset": "${dataloader.dataset}", "drop": [], "end": 2021, "frequency": "${data.frequency}", "start": 2021}, "validation_rollout": 1}, "diagnostics": {"benchmark_profiler": {"memory": {"enabled": true, "extra_plots": false, "steps": 5, "trace_rank0_only": false, "warmup": 2}, "model_summary": {"enabled": true}, "snapshot": {"enabled": true, "steps": 4, "warmup": 0}, "speed": {"enabled": true}, "system": {"enabled": true}, "time": {"enabled": true, "verbose": false}}, "callbacks": [{"_target_": "anemoi.training.diagnostics.callbacks.stopping.TimeLimit", "limit": "10m", "record_file": "training_complete"}], "checkpoint": {"every_n_epochs": {"num_models_saved": -1, "save_frequency": 1}, "every_n_minutes": {"num_models_saved": 3, "save_frequency": 30}, "every_n_train_steps": {"num_models_saved": 0, "save_frequency": null}}, "debug": {"anomaly_detection": false}, "enable_checkpointing": true, "enable_progress_bar": true, "log": {"interval": 100, "mlflow": {"authentication": false, "enabled": false, "expand_hyperparams": ["config"], "experiment_name": "anemoi-debug", "http_max_retries": 35, "log_model": false, "offline": false, "on_resume_create_child": true, "project_name": "Anemoi", "run_name": null, "system": true, "terminal": true, "tracking_uri": null}, "tensorboard": {"enabled": false}, "wandb": {"enabled": false, "entity": null, "gradients": false, "log_model": false, "offline": false, "parameters": false, "project": "Anemoi"}}, "plot": {"asynchronous": true, "callbacks": [{"_target_": "anemoi.training.diagnostics.callbacks.plot.PlotLoss", "every_n_batches": "${diagnostics.plot.frequency.batch}", "parameter_groups": {"moisture": ["tp", "cp", "tcw"], "sfc_wind": ["10u", "10v"]}}, {"_target_": "anemoi.training.diagnostics.callbacks.plot.PlotSample", "accumulation_levels_plot": [0, 0.05, 0.1, 0.25, 0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 100], "colormaps": "${diagnostics.plot.colormaps}", "every_n_batches": "${diagnostics.plot.frequency.batch}", "parameters": "${diagnostics.plot.parameters}", "per_sample": 6, "precip_and_related_fields": "${diagnostics.plot.precip_and_related_fields}", "sample_idx": "${diagnostics.plot.sample_idx}"}], "colormaps": {"precip": {"_target_": "anemoi.training.utils.custom_colormaps.MatplotlibColormapClevels", "clevels": ["#ffffff", "#04e9e7", "#019ff4", "#0300f4", "#02fd02", "#01c501", "#008e00", "#fdf802", "#e5bc00", "#fd9500", "#fd0000", "#d40000", "#bc0000", "#f800fd"], "variables": "${diagnostics.plot.precip_and_related_fields}"}}, "datashader": true, "frequency": {"batch": 750, "epoch": 10}, "parameters": ["z_500", "t_850", "u_850", "v_850", "2t", "10u", "10v", "sp", "tp", "cp"], "precip_and_related_fields": ["tp", "cp"], "sample_idx": 0}, "print_memory_summary": false, "profiler": false}, "graph": {"attributes": {"edges": {"edge_dirs": {"_target_": "anemoi.graphs.edges.attributes.EdgeDirection", "norm": "unit-std"}, "edge_length": {"_target_": "anemoi.graphs.edges.attributes.EdgeLength", "norm": "unit-std"}}, "nodes": {"area_weight": {"_target_": "anemoi.graphs.nodes.attributes.SphericalAreaWeights", "fill_value": 0, "norm": "unit-max"}}}, "data": "data", "edges": [{"attributes": "${graph.attributes.edges}", "edge_builders": [{"_target_": "anemoi.graphs.edges.CutOffEdges", "cutoff_factor": 0.6, "source_mask_attr_name": null, "target_mask_attr_name": null}], "source_name": "${graph.data}", "target_name": "${graph.hidden}"}, {"attributes": "${graph.attributes.edges}", "edge_builders": [{"_target_": "anemoi.graphs.edges.MultiScaleEdges", "source_mask_attr_name": null, "target_mask_attr_name": null, "x_hops": 1}], "source_name": "${graph.hidden}", "target_name": "${graph.hidden}"}, {"attributes": "${graph.attributes.edges}", "edge_builders": [{"_target_": "anemoi.graphs.edges.KNNEdges", "num_nearest_neighbours": 3, "source_mask_attr_name": null, "target_mask_attr_name": null}], "source_name": "${graph.hidden}", "target_name": "${graph.data}"}], "hidden": "hidden", "nodes": {"data": {"attributes": "${graph.attributes.nodes}", "node_builder": {"_target_": "anemoi.graphs.nodes.ZarrDatasetNodes", "dataset": "${dataloader.dataset}"}}, "hidden": {"attributes": "${graph.attributes.nodes}", "node_builder": {"_target_": "anemoi.graphs.nodes.TriNodes", "resolution": 5}}}, "overwrite": true, "post_processors": []}, "hardware": {"accelerator": "auto", "files": {"checkpoint": {"every_n_epochs": "aifs-by_epoch-epoch_{epoch:03d}-val_wmse_{val_wmse:.3e}", "every_n_minutes": "aifs-by_time-epoch_{epoch:03d}-step_{step:06d}", "every_n_train_steps": "aifs-by_step-epoch_{epoch:03d}-step_{step:06d}"}, "dataset": "aifs-ea-an-oper-0001-mars-${hardware.files.resolution}-1979-2022-6h-v6.zarr", "dataset_land": "aifs-ea-an-oper-0001-mars-${hardware.files.resolution}-1979-2023-6h-v1-land-reduced.zarr", "graph": "graph_enc_proc_dec_${hardware.files.resolution}.pt", "resolution": "o48", "warm_start": null}, "num_gpus_per_model": 1, "num_gpus_per_node": 1, "num_nodes": 1, "paths": {"checkpoints": "${hardware.paths.output}checkpoint/", "data": "/home/mlx/ai-ml/datasets/stable", "graph": "${hardware.paths.output}graphs/", "logs": {"base": "${hardware.paths.output}logs/", "mlflow": "${hardware.paths.logs.base}mlflow/", "tensorboard": "${hardware.paths.logs.base}tensorboard/", "wandb": "${hardware.paths.logs.base}"}, "output": "/perm/mlx/shared/anemoi/training/", "plots": "${hardware.paths.output}plots/", "profiler": "${hardware.paths.output}profiler/"}}, "model": {"activation": "GELU", "attributes": {"edges": ["edge_length", "edge_dirs"], "nodes": []}, "bounding": [{"_target_": "anemoi.models.layers.bounding.ReluBounding", "variables": ["tp"]}], "cpu_offload": false, "decoder": {"_target_": "anemoi.models.layers.mapper.GNNBackwardMapper", "activation": "${model.activation}", "cpu_offload": "${model.cpu_offload}", "mlp_extra_layers": 0, "num_chunks": 1, "sub_graph_edge_attributes": "${model.attributes.edges}", "trainable_size": "${model.trainable_parameters.hidden2data}"}, "encoder": {"_target_": "anemoi.models.layers.mapper.GNNForwardMapper", "activation": "${model.activation}", "cpu_offload": "${model.cpu_offload}", "mlp_extra_layers": 0, "num_chunks": 1, "sub_graph_edge_attributes": "${model.attributes.edges}", "trainable_size": "${model.trainable_parameters.data2hidden}"}, "layer_kernels": {"LayerNorm": {"_partial_": true, "_target_": "anemoi.models.layers.normalization.AutocastLayerNorm"}, "Linear": {"_partial_": true, "_target_": "torch.nn.Linear"}}, "model": {"_target_": "anemoi.models.models.encoder_processor_decoder.AnemoiModelEncProcDec"}, "num_channels": 512, "output_mask": null, "processor": {"_target_": "anemoi.models.layers.processor.GNNProcessor", "activation": "${model.activation}", "cpu_offload": "${model.cpu_offload}", "mlp_extra_layers": 0, "num_chunks": 2, "num_layers": 16, "sub_graph_edge_attributes": "${model.attributes.edges}", "trainable_size": "${model.trainable_parameters.hidden2hidden}"}, "trainable_parameters": {"data": 8, "data2hidden": 8, "hidden": 8, "hidden2data": 8, "hidden2hidden": 8}}, "no_validation": false, "training": {"accum_grad_batches": 1, "deterministic": false, "fork_run_id": null, "gradient_clip": {"algorithm": "value", "val": 32.0}, "load_weights_only": false, "loss_gradient_scaling": false, "lr": {"iterations": "${training.max_steps}", "min": 3e-07, "rate": 6.25e-05, "warmup_t": 1000}, "max_epochs": 1, "max_steps": 150000, "metrics": ["z_500", "t_850", "u_850", "v_850"], "multistep_input": 2, "node_loss_weights": {"_target_": "anemoi.training.losses.nodeweights.GraphNodeAttribute", "node_attribute": "area_weight", "target_nodes": "${graph.data}"}, "num_sanity_val_steps": 6, "precision": "16-mixed", "pressure_level_scaler": {"_target_": "anemoi.training.data.scaling.ReluPressureLevelScaler", "minimum": 0.2, "slope": 0.001}, "rollout": {"epoch_increment": 0, "max": 1, "start": 1}, "run_id": null, "run_id_with_no_checkpoint": false, "scale_validation_metrics": {"metrics": ["all"], "scalars_to_apply": ["variable"]}, "submodules_to_freeze": [], "swa": {"enabled": false, "lr": 0.0001}, "training_loss": {"_target_": "anemoi.training.losses.mse.WeightedMSELoss", "ignore_nans": false, "scalars": ["variable", "loss_weights_mask"]}, "transfer_learning": false, "validation_metrics": [{"_target_": "anemoi.training.losses.mse.WeightedMSELoss", "ignore_nans": true, "scalars": []}], "variable_loss_scaling": {"default": 1, "pl": {"q": 0.6, "t": 6, "u": 0.8, "v": 0.5, "w": 0.001, "z": 12}, "sfc": {"10u": 0.1, "10v": 0.1, "2d": 0.5, "cp": 0.0025, "sp": 10, "tp": 0.025}}, "zero_optimizer": false}}}
